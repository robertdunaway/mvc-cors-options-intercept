mashupApp.controller("mashup.LoginController",["$location","$log","$timeout","$scope","sessionService","cacheService","utility",function(s,e,a,n,i,o,p){"use strict";var t=this;t.appName="coreSession";var r=function(){return o.getCache("mashupSessions")};r().then(function(s){t.appSession=s[0],("NoCache"===t.appSession||"N"===t.appSession||_.isNull(t.appSession)||_.isUndefined(t.appSession))&&(t.appSession={sessions:[]},t.appSession.id="mashupSessions");var e=_.findIndex(t.appSession.sessions,{appName:t.appName});e>-1&&(t.labelUserName=t.appSession.sessions[e].userName)}),t.login=function(){var e=!0;e?(u(t.name,t.appName),m(t.name,t.appName),c(t.name,t.appName,e),s.path("/")):c(t.name,t.appName,e)};var m=function(s,e){var a=i.getUserSessions();a.userName=s,a.appName=e,i.setUserSession(a)},u=function(s,e){var a;a=!!_.where(t.appSession.sessions,{appName:e}).length;var n=l(s,e);if(a){var i=_.findIndex(t.appSession.sessions,{appName:e});t.appSession.sessions[i]=n}else t.appSession.sessions.push(n);o.putCache("mashupSessions",{name:"mashupSessions",keyPath:"id"},t.appSession)},l=function(s,e){var a={},n=p.localMilToUtcMil((new Date).getTime()),i=p.utcMilToLocalMil(n),o=Date(i),t=["DomainUser","MashupUser","Administrator"];return a.appName=e,a.userName=s,a.roles=t,a.authTimeUTCMills=n,a.authTimelocalMills=i,a.authTimelocalDate=o,a.sessionLastUsed=n,a.isAuthenticated=!0,a},c=function(s,a,n){var o=p.getLogObject("Instr",a,"mashup.LoginController","login",n,i);o.userName=s,o.appName=a,o.authenticated=n,e.log("Authentication [ User: "+s+" ] on [App: "+a+" ]",o)}}]);
//# sourceMappingURL=../../apps/mashup/login.controller.min.js.map